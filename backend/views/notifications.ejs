<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notifications - FinTrack</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        secondary: '#1E40AF',
                        accent: '#10B981',
                        success: '#10B981',
                        warning: '#F59E0B',
                        danger: '#EF4444',
                    }
                }
            }
        }
    </script>
    <style>
        .card-hover {
            transition: all 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>

<body class="bg-gradient-to-b from-gray-900 to-gray-500 min-h-screen">
    <!-- Navigation Bar -->
    <nav class="bg-gradient-to-b from-black to-transparent sticky top-0 z-30">
        <div class="max-w-8xl mx-auto px-4">
          <div class="flex justify-between items-center py-4 px-4">
            <!-- Logo -->
            <a href="/dashboard" class="flex items-center group">
              <div
                class="inline-flex items-center justify-center w-10 h-10 bg-primary rounded-full mr-3 transition-transform group-hover:scale-105"
              >
                <i class="fas fa-wallet text-white"></i>
              </div>
              <h1 class="text-xl font-bold text-gray-400 hidden sm:block group-hover:text-primary transition-colors">FinTrack</h1>
            </a>
  
            <!-- Navigation Links -->
            <div class="flex items-center justify-between space-x-2 flex-wrap">
              <a
                href="/dashboard"
                class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-secondary transition duration-200 flex items-center justify-center"
                title="Dashboard"
              >
                <i class="fas fa-home"></i>
              </a>
              <a
                href="/transactions"
                class="text-gray-300 hover:text-primary transition duration-200 px-4 py-2 bg-black bg-opacity-40 backdrop-blur-md rounded-lg flex items-center justify-center"
                title="Transactions"
              >
                <i class="fas fa-exchange-alt"></i>
              </a>
              <a
                href="/budgets"
                class="text-gray-300 hover:text-primary transition duration-200 px-4 py-2 bg-black bg-opacity-40 backdrop-blur-md rounded-lg flex items-center justify-center"
                title="Budgets"
              >
                <i class="fas fa-chart-pie"></i>
              </a>
              <a
                href="/categories"
                class="text-gray-300 hover:text-primary transition duration-200 px-4 py-2 bg-black bg-opacity-40 backdrop-blur-md rounded-lg flex items-center justify-center"
                title="Categories"
              >
                <i class="fas fa-tags"></i>
              </a>
              <a
                href="/saving-goals"
                class="text-gray-300 hover:text-primary transition duration-200 px-4 py-2 bg-black bg-opacity-40 backdrop-blur-md rounded-lg flex items-center justify-center"
                title="Saving Goals"
              >
                <i class="fas fa-piggy-bank"></i>
              </a>
              <a
                href="/notifications"
                class="text-gray-300 hover:text-primary transition duration-200 px-4 py-2 bg-black bg-opacity-40 backdrop-blur-md rounded-lg flex items-center justify-center"
                title="Notifications"
              >
                <i class="fas fa-bell"></i>
              </a>
              <a
                href="/export"
                class="text-gray-300 hover:text-primary transition duration-200 px-4 py-2 bg-black bg-opacity-40 backdrop-blur-md rounded-lg flex items-center justify-center"
                title="Export"
              >
                <i class="fas fa-download"></i>
              </a>
              <a
                href="/profile"
                class="text-gray-300 hover:text-primary transition duration-200 px-4 py-2 bg-black bg-opacity-40 backdrop-blur-md rounded-lg flex items-center justify-center"
                title="Profile"
              >
                <i class="fas fa-user"></i>
              </a>
              <a
                href="/auth/logout"
                class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition duration-200 flex items-center justify-center"
                title="Logout"
              >
                <i class="fas fa-sign-out-alt"></i>
              </a>
            </div>
          </div>
        </div>
      </nav>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-4 py-8">
        <!-- Header -->
        <div class="mb-8">
            <h2 class="text-3xl font-bold text-white mb-2">
                <i class="fas fa-bell mr-3"></i>Notifications
            </h2>
            <p class="text-gray-300">Stay updated with your budget alerts and financial insights</p>
        </div>

        <!-- Messages -->
        <% if (error) { %>
            <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-6">
                <i class="fas fa-exclamation-triangle mr-2"></i><%= error %>
            </div>
        <% } %>

        <% if (success) { %>
            <div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-6">
                <i class="fas fa-check-circle mr-2"></i><%= success %>
            </div>
        <% } %>

        <!-- Notifications Actions -->
        <div class="flex justify-between items-center mb-6">
            <div class="flex space-x-4">
                <button onclick="markAllAsRead()" class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-secondary transition duration-200">
                    <i class="fas fa-check-double mr-2"></i>Mark All as Read
                </button>
                <button onclick="checkBudgets()" class="bg-accent text-white px-4 py-2 rounded-lg hover:bg-green-600 transition duration-200">
                    <i class="fas fa-sync mr-2"></i>Check Budgets Now
                </button>
            </div>
            <div class="text-white">
                <span class="text-sm">Total: <%= notifications.length %> notifications</span>
            </div>
        </div>

        <!-- Notifications List -->
        <div class="space-y-4">
            <% if (notifications && notifications.length > 0) { %>
                <% notifications.forEach(notification => { %>
                    <div class="bg-white rounded-lg shadow-lg p-6 card-hover <%= notification.isRead ? 'opacity-75' : '' %>">
                        <div class="flex items-start justify-between">
                            <div class="flex-1">
                                <div class="flex items-center mb-2">
                                    <% if (notification.type === 'budget_exceeded') { %>
                                        <i class="fas fa-exclamation-triangle text-red-500 mr-3"></i>
                                        <h3 class="text-lg font-semibold text-red-600"><%= notification.title %></h3>
                                    <% } else if (notification.type === 'budget_warning') { %>
                                        <i class="fas fa-exclamation-circle text-yellow-500 mr-3"></i>
                                        <h3 class="text-lg font-semibold text-yellow-600"><%= notification.title %></h3>
                                    <% } else { %>
                                        <i class="fas fa-info-circle text-blue-500 mr-3"></i>
                                        <h3 class="text-lg font-semibold text-blue-600"><%= notification.title %></h3>
                                    <% } %>
                                    
                                    <% if (!notification.isRead) { %>
                                        <span class="bg-primary text-white text-xs px-2 py-1 rounded-full ml-2">New</span>
                                    <% } %>
                                </div>
                                
                                <p class="text-gray-700 mb-3"><%= notification.message %></p>
                                
                                <% if (notification.budget) { %>
                                    <div class="bg-gray-50 rounded-lg p-4 mb-3">
                                        <h4 class="font-semibold text-gray-800 mb-2">Budget Details:</h4>
                                        <div class="grid grid-cols-2 gap-4 text-sm">
                                            <div>
                                                <span class="text-gray-600">Budget:</span>
                                                <span class="font-medium"><%= notification.budget.name %></span>
                                            </div>
                                            <div>
                                                <span class="text-gray-600">Category:</span>
                                                <span class="font-medium"><%= notification.budget.category ? notification.budget.category.name : 'General' %></span>
                                            </div>
                                            <div>
                                                <span class="text-gray-600">Budget Amount:</span>
                                                <span class="font-medium">$<%= parseFloat(notification.budget.maxAmount).toFixed(2) %></span>
                                            </div>
                                            <div>
                                                <span class="text-gray-600">Amount Spent:</span>
                                                <span class="font-medium">$<%= parseFloat(notification.budget.spentAmount).toFixed(2) %></span>
                                            </div>
                                        </div>
                                    </div>
                                <% } %>
                                
                                <div class="flex items-center text-sm text-gray-500">
                                    <i class="fas fa-clock mr-2"></i>
                                    <span><%= new Date(notification.sentAt).toLocaleString() %></span>
                                </div>
                            </div>
                            
                            <div class="ml-4">
                                <% if (!notification.isRead) { %>
                                    <button onclick="markAsRead('<%= notification.id %>')" class="bg-primary text-white px-3 py-1 rounded text-sm hover:bg-secondary transition duration-200">
                                        <i class="fas fa-check mr-1"></i>Mark Read
                                    </button>
                                <% } else { %>
                                    <span class="text-gray-400 text-sm">
                                        <i class="fas fa-check mr-1"></i>Read
                                    </span>
                                <% } %>
                            </div>
                        </div>
                    </div>
                <% }); %>
            <% } else { %>
                <div class="text-center py-12">
                    <div class="bg-white rounded-lg p-8 shadow-lg">
                        <i class="fas fa-bell-slash text-6xl text-gray-400 mb-4"></i>
                        <h3 class="text-2xl font-semibold text-gray-600 mb-2">No Notifications</h3>
                        <p class="text-gray-500 mb-6">You're all caught up! No new notifications at the moment.</p>
                        <a href="/budgets" class="inline-flex items-center px-6 py-3 bg-primary text-white rounded-lg hover:bg-secondary transition duration-200">
                            <i class="fas fa-chart-pie mr-2"></i>Manage Budgets
                        </a>
                    </div>
                </div>
            <% } %>
        </div>
    </div>
    <script>

        async function markAsRead(notificationId) {
            try {
                const response = await fetch(`/notifications/${notificationId}/read`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });

                const result = await response.json();
                
                if (result.success) {
                    location.reload();
                } else {
                    alert('Error marking notification as read');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error marking notification as read');
            }
        }

        async function markAllAsRead() {
            try {
                const response = await fetch('/notifications/mark-all-read', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });

                const result = await response.json();
                
                if (result.success) {
                    location.reload();
                } else {
                    alert('Error marking all notifications as read');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error marking all notifications as read');
            }
        }

        async function checkBudgets() {
            try {
                const response = await fetch('/notifications/check-budgets', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });

                const result = await response.json();
                
                if (result.success) {
                    alert(`Budget check completed. ${result.notificationsSent} notifications sent.`);
                    location.reload();
                } else {
                    alert('Error checking budgets');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error checking budgets');
            }
        }
    </script>
</body>
</html>
